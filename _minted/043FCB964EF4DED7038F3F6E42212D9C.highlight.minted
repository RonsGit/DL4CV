\begin{MintedVerbatim}[commandchars=\\\{\}]
		\PYG{c+c1}{\PYGZsh{} Compute attention mask: compare group IDs between tokens in each window}
		\PYG{n}{attn\PYGZus{}mask} \PYG{o}{=} \PYG{n}{mask\PYGZus{}windows}\PYG{o}{.}\PYG{n}{unsqueeze}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{mask\PYGZus{}windows}\PYG{o}{.}\PYG{n}{unsqueeze}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
		\PYG{n}{attn\PYGZus{}mask} \PYG{o}{=} \PYG{n}{attn\PYGZus{}mask}\PYG{o}{.}\PYG{n}{masked\PYGZus{}fill}\PYG{p}{(}\PYG{n}{attn\PYGZus{}mask} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{100.0}\PYG{p}{)}\PYG{p}{)}
		\PYG{n}{attn\PYGZus{}mask} \PYG{o}{=} \PYG{n}{attn\PYGZus{}mask}\PYG{o}{.}\PYG{n}{masked\PYGZus{}fill}\PYG{p}{(}\PYG{n}{attn\PYGZus{}mask} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{(}\PYG{l+m+mf}{0.0}\PYG{p}{)}\PYG{p}{)}
\end{MintedVerbatim}
